<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="icon" href="/images/favicon.svg">
  
  <link rel="stylesheet" href="/scss/global.min.cc2decf9a377d0295f586f0965eb58a37bfacb6fc8780a8e356d6d97e005f264.css">
  
  <link rel="stylesheet" href="/css/prism.css" />
  <link href="https://fonts.googleapis.com/css?family=Merriweather&display=swap" rel="stylesheet">
  

 






	




<title>Phoenix API uygulaması (part 2) | muratbastas</title>
<meta name="description" content="İlk halini dün yayınladığım phoenix framework API uygulaması serisinin ikinci yazısıdır.
Dün basitçe crud işlemleri yapan bir endpoint hazırlamıştık. Tabi ki sırada bir API ın olmazsa olmazı authentication işlemlerini nasıl yapacağımızdan bahsedeceğim.
Öncelikle ihtiyaç duyacağımız paketlerden bahsedelim. Ruby yazanlar ve Rails ile uygulama geliştirenler bilirler plataformatec&rsquo;in geliştirdiği ve José Valim abimizin, yani Elixir dilinin yaratıcısının çok büyük katkıları olan devise adında bir gem var ki authentication adına ne var ise her şeyi 3-5 generator komutu ile saniyeler içerisinde halledebiliyorsunuz.">
<meta property="og:title" content="Phoenix API uygulaması (part 2) | muratbastas">
<meta property="og:site_name" content="muratbastas">
<meta property="og:description" content="İlk halini dün yayınladığım phoenix framework API uygulaması serisinin ikinci yazısıdır.
Dün basitçe crud işlemleri yapan bir endpoint hazırlamıştık. Tabi ki sırada bir API ın olmazsa olmazı authentication işlemlerini nasıl yapacağımızdan bahsedeceğim.
Öncelikle ihtiyaç duyacağımız paketlerden bahsedelim. Ruby yazanlar ve Rails ile uygulama geliştirenler bilirler plataformatec&rsquo;in geliştirdiği ve José Valim abimizin, yani Elixir dilinin yaratıcısının çok büyük katkıları olan devise adında bir gem var ki authentication adına ne var ise her şeyi 3-5 generator komutu ile saniyeler içerisinde halledebiliyorsunuz.">
<meta property="og:url" content="http://localhost:1313/2019/04/14/phoenix-api-uygulamas%C4%B1-part-2/">
<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:image" content='http://localhost:1313/uploads/default.jpg'><meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Phoenix API uygulaması (part 2) | muratbastas">

	<link rel="canonical" href="http://localhost:1313/2019/04/14/phoenix-api-uygulamas%C4%B1-part-2/">


	<meta name="twitter:site" content="@https://twitter.com/muratbastas">
	<meta name="twitter:creator" content="@https://twitter.com/muratbastas">

	<meta name="twitter:description" content="İlk halini dün yayınladığım phoenix framework API uygulaması serisinin ikinci yazısıdır.
Dün basitçe crud işlemleri yapan bir endpoint hazırlamıştık. Tabi ki sırada bir API ın olmazsa olmazı authentication işlemlerini nasıl yapacağımızdan bahsedeceğim.
Öncelikle ihtiyaç duyacağımız paketlerden bahsedelim. Ruby yazanlar ve Rails ile uygulama geliştirenler bilirler plataformatec&rsquo;in geliştirdiği ve José Valim abimizin, yani Elixir dilinin yaratıcısının çok büyük katkıları olan devise adında bir gem var ki authentication adına ne var ise her şeyi 3-5 generator komutu ile saniyeler içerisinde halledebiliyorsunuz.">
<meta name="twitter:image" content="http://localhost:1313/uploads/default.jpg">
<meta property="article:published_time" content="2019-04-14T17:35:12&#43;30:00">
	<meta property="article:updated_time" content="2019-04-14T17:35:12&#43;30:00">



  <script>localStorage.setItem("isLight", 'true')</script>

  <style>
    p, .code-toolbar, ul, .article-header {
      max-width: 96%;
    }
    .nav-container {
      display: flex;
      justify-content: center;
    }
    .section {
      padding: 2rem;
    }
    .subheading-container { 
      margin-bottom: 1rem;
    }
    .article-hero-heading {
      max-width: 96%;
      text-align: center;
    }
    .articles-list-container-alt .post-row .article-link .article-data-outer .article-data { max-width: 100% !important; width: 100% !important; }
    .post-row > a { margin: 1rem 0 !important; }
    .article-data .article-title { margin: 1rem 0 !important }
    .article-header, .article-title {
      padding-left: initial;
    }
    .article-hero-subtitle {
      display: flex;
      justify-content: center;
    }
    h1, h2, h3, h4, h5, h6 { max-width: 96%; }
    @media screen and (max-width: 540px) {
      .article-header { margin: 10px 0; padding: 0; }
      .article-header h1 { padding: 0; }
      .article-link { box-shadow: none; }
      .article-title { padding: 0; margin: 10px 0; }
      .article-excerpt { display: none; }
      .article-metadata { padding: 0; }
      h1, h2, h3, h4, h5, h6 { padding: 0 1rem; }
    }
    p>code {
      color: #f8f8f2;
      background-color: #919191;
      padding: 0 4px;
      border-radius: 3px;
    }
    #articleContent {
      padding: 0 0 35px;
    }
    #articleContent>figure>img {
      max-width: 100% !important;
    }
    blockquote p {
      font-size: initial !important;
      padding: 1rem 0;
      max-width: 96% !important;
    }
  </style>
</head>


<body class="line-numbers">

    
    <script src="/js/initColors.js"></script>

    <div class="layout-styled">

        <Section class="section">
  <div class="nav-container">
    <a class="logo-link" href="/">
      🐱‍👤 <span style="font-weight: bold">&nbsp;&nbsp;denemeler (by murat bastas)</span>
      <span class="header-hidden">Navigate back to the homepage</span>
    </a>
    <div class="nav-controls">
      
      
      
    </div>
</div>
</Section>


<script src="/js/toggleLogos.js"></script>


<script src="/js/toggleColors.js"></script>


<script src="/js/copyUrl.js"></script>

        

<section class="section narrow">

  <section id="articleHero" class="section narrow">
  <div class="article-hero">
    <header class="article-header">
      <h1 class="article-hero-heading">Phoenix API uygulaması (part 2)</h1>
      <div class="article-hero-subtitle">
        <div class="article-meta">
          
          April 14, 2019
          
        </div>
      </div>
    </header>
    
  </div>
</section>


  


  <article id="articleContent" class="post-content">
    
    <nav id="TableOfContents"></nav>
    

    <p>İlk halini <a href="/2019/04/13/phoenix-api-uygulamas%C4%B1-part-1/">dün yayınladığım phoenix framework API uygulaması</a> serisinin ikinci yazısıdır.</p>
<p>Dün basitçe crud işlemleri yapan bir endpoint hazırlamıştık. Tabi ki sırada bir API ın olmazsa olmazı authentication işlemlerini nasıl yapacağımızdan bahsedeceğim.</p>
<p>Öncelikle ihtiyaç duyacağımız paketlerden bahsedelim. Ruby yazanlar ve Rails ile uygulama geliştirenler bilirler plataformatec&rsquo;in geliştirdiği ve José Valim abimizin, yani Elixir dilinin yaratıcısının çok büyük katkıları olan <a href="https://github.com/plataformatec/devise">devise</a> adında bir gem var ki authentication adına ne var ise her şeyi 3-5 generator komutu ile saniyeler içerisinde halledebiliyorsunuz. Elixir topluluğu için geliştirilen <a href="https://github.com/smpallen99/coherence">coherence</a> adında bir devise alternatifi olsa da ben authentication işlemleri için yaygın olarak <a href="https://github.com/ueberauth/guardian">guardian</a> paketini kullanmayı tercih ediyorum. Bu bölümde de guardian ile basit bir authentication nasıl yapılır bundan bahsedeceğim.</p>
<p>Paketleri deps fonksiyonuna ekleyerek başlayalım.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ex" data-lang="ex">defp deps do
  <span style="color:#75715e"># bcrypt eklemiştik ama altını tekrar çizelim...</span>
  {<span style="color:#e6db74">:bcrypt_elixir</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">~&gt;  2.0</span><span style="color:#e6db74">&#34;</span>},
  <span style="color:#75715e"># ...</span>
  {<span style="color:#e6db74">:guardian</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">~&gt; 1.2</span><span style="color:#e6db74">&#34;</span>}
  <span style="color:#75715e"># ...</span>
end
</code></pre></div><p><code>mix deps.get</code> diyerek guardian'ı projemize ekliyoruz. Dileyen <a href="https://github.com/ueberauth/guardian/blob/master/guides/tutorial/start-tutorial.md">şuraya da</a> bakabilir.</p>
<p>Guardian bize JWT token üretme imkanı tanıyacak, bunun için ufak bir konfigürasyon yapmakta fayda var. <code>config/config.exs</code> dosyamıza aşağıdaki konfigürasyonu ekleyelim.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ex" data-lang="ex"><span style="color:#75715e"># ...</span>
config <span style="color:#e6db74">:app</span>, <span style="color:#a6e22e">App.Auth.Guardian</span>,
  <span style="color:#e6db74">issuer</span>: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">app</span><span style="color:#e6db74">&#34;</span>,
  <span style="color:#e6db74">secret_key</span>: <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>get_env(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">GUARDIAN_SECRET_KEY</span><span style="color:#e6db74">&#34;</span>)
<span style="color:#75715e"># ...</span>
</code></pre></div><p><strong>Not</strong> <code>App.Auth.Guardian</code> modülünü birazdan oluşturacağız.</p>
<p><code>router.ex</code> dosyamızda gerekli değişiklikleri yapalım&hellip;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ex" data-lang="ex">pipeline <span style="color:#e6db74">:ensure_auth</span> do
  plug <span style="color:#a6e22e">App.Auth.Guardian.Pipeline</span>
end

scope <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/api</span><span style="color:#e6db74">&#34;</span>, <span style="color:#a6e22e">AppWeb</span> do
  pipe_through <span style="color:#e6db74">:api</span>

  scope <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/auth</span><span style="color:#e6db74">&#34;</span>, <span style="color:#a6e22e">Auth</span> do
    resources <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/sign_up</span><span style="color:#e6db74">&#34;</span>, <span style="color:#a6e22e">RegisterController</span>, <span style="color:#e6db74">only</span>: [<span style="color:#e6db74">:create</span>]
    resources <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/sign_in</span><span style="color:#e6db74">&#34;</span>, <span style="color:#a6e22e">SessionController</span>, <span style="color:#e6db74">only</span>: [<span style="color:#e6db74">:create</span>]
  end
end

scope <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/api</span><span style="color:#e6db74">&#34;</span>, <span style="color:#a6e22e">AppWeb</span> do
  pipe_through [<span style="color:#e6db74">:api</span>, <span style="color:#e6db74">:ensure_auth</span>]

  scope <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/v1</span><span style="color:#e6db74">&#34;</span>, <span style="color:#a6e22e">V1</span> do
    resources <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/users</span><span style="color:#e6db74">&#34;</span>, <span style="color:#a6e22e">UserController</span>, <span style="color:#e6db74">except</span>: [<span style="color:#e6db74">:new</span>, <span style="color:#e6db74">:edit</span>]
  end
end
</code></pre></div><p>Bir önceki yazıda, <code>resources &quot;/users&quot;</code> resource&rsquo;unu sadece <code>api</code> pipeline'ından geçirmiştik, şimdi bu resource rotasını yine <code>/api</code> scope&rsquo;u içinde kalarak <code>pipe_through [:api, :ensure_auth]</code> pipeline&rsquo;larından geçireceğiz. <code>:ensure_auth</code> pipeline'ında <code>App.Auth.Guardian.Pipeline</code> adında bir plug'ın varlığından bahsettik. <code>lib/app/auth/guardian/pipeline.ex</code> path&rsquo;inde aynı isimle bir module tanımlayarak içeriğini aşağıdaki gibi yapalım.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ex" data-lang="ex">defmodule <span style="color:#a6e22e">App.Auth.Guardian.Pipeline</span> do
  use <span style="color:#a6e22e">Guardian.Plug.Pipeline</span>, <span style="color:#e6db74">otp_app</span>: <span style="color:#e6db74">:app</span>,
                              <span style="color:#e6db74">module</span>: <span style="color:#a6e22e">App.Auth.Guardian</span>,
                              <span style="color:#e6db74">error_handler</span>: <span style="color:#a6e22e">App.Auth.Guardian.ErrorHandler</span>

  <span style="color:#75715e"># Requestlerde authorization header arayıp, token bir access token ise doğrula</span>
  plug <span style="color:#a6e22e">Guardian.Plug.VerifyHeader</span>, <span style="color:#e6db74">claims</span>: %{<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">typ</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span><span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">access</span><span style="color:#e6db74">&#34;</span>}
  plug <span style="color:#a6e22e">Guardian.Plug.EnsureAuthenticated</span>
end
</code></pre></div><p>Bu oluşturduğumuz modül <code>Guardian.Plug.Pipeline</code> modülünü konfigüre eder. Yukarıdaki modülde görüldüğü gibi iki modüle daha ihtiyacı var, birincisi <code>App.Auth.Guardian</code> ikincisi <code>App.Auth.Guardian.ErrorHandler</code>, bu modülleri de oluşturalım ve içlerini aşağıdaki gibi dolduralım.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ex" data-lang="ex"><span style="color:#75715e"># lib/app/auth/guardian.ex</span>
defmodule <span style="color:#a6e22e">App.Auth.Guardian</span> do
  use <span style="color:#a6e22e">Guardian</span>, <span style="color:#e6db74">otp_app</span>: <span style="color:#e6db74">:app</span>

  alias <span style="color:#a6e22e">App.Auth</span>

  def subject_for_token(resource, _claims), <span style="color:#e6db74">do</span>: {<span style="color:#e6db74">:ok</span>, to_string(resource<span style="color:#f92672">.</span>id)}

  def resource_from_claims(claims) do
    <span style="color:#a6e22e">Auth</span><span style="color:#f92672">.</span>get_user!(claims[<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">sub</span><span style="color:#e6db74">&#34;</span>])
  end
end

<span style="color:#75715e"># lib/app/auth/guardian/error_handler.ex</span>
defmodule <span style="color:#a6e22e">App.Auth.Guardian.ErrorHandler</span> do
  import <span style="color:#a6e22e">Plug.Conn</span>

  <span style="color:#a6e22e">@behaviour</span> <span style="color:#a6e22e">Guardian.Plug.ErrorHandler</span>
  <span style="color:#a6e22e">@impl</span> <span style="color:#a6e22e">Guardian.Plug.ErrorHandler</span>
  def auth_error(conn, {type, _reason}, _opts) do
    body <span style="color:#f92672">=</span> <span style="color:#a6e22e">Poison</span><span style="color:#f92672">.</span>encode!(%{<span style="color:#e6db74">meta</span>: %{<span style="color:#e6db74">status</span>: to_string(type)}})

    conn
    <span style="color:#f92672">|&gt;</span> put_resp_content_type(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">application/json</span><span style="color:#e6db74">&#34;</span>)
    <span style="color:#f92672">|&gt;</span> send_resp(<span style="color:#ae81ff">401</span>, body)
  end
end
</code></pre></div><p><code>App.Auth.Guardian</code> modülündeki <code>resource_from_claims/1</code> fonksiyonu <code>claims</code> map&rsquo;i içinde <code>&quot;sub&quot;</code> key&rsquo;i ile kullanıcımızın <code>id</code> sini tutacak. Bu id ile <code>Auth</code> modülünde <code>get_user!/1</code> fonksiyonunu çağırarak giriş yapmış kullanıcının veritabanı kaydını bulacağız. <code>ErrorHandler</code> modülümüz ise authentication hatalarını alıp 401 http statüsü ile cevap verecek.</p>
<p>Şimdi <code>SessionController</code> modülümüzü oluşturalım.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ex" data-lang="ex">defmodule <span style="color:#a6e22e">AppWeb.Auth.SessionController</span> do
  use <span style="color:#a6e22e">AppWeb</span>, <span style="color:#e6db74">:controller</span>
  alias <span style="color:#a6e22e">App.Auth</span>

  action_fallback <span style="color:#a6e22e">AppWeb.FallbackController</span>

  def create(conn, %{<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">user</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span><span style="color:#f92672">&gt;</span> %{<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">email</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span><span style="color:#f92672">&gt;</span> email, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">password</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span><span style="color:#f92672">&gt;</span> password}}) do
    case <span style="color:#a6e22e">Auth</span><span style="color:#f92672">.</span>authenticate_user(email, password) do
      {<span style="color:#e6db74">:ok</span>, token, _claims}<span style="color:#f92672">-&gt;</span>
        conn
        <span style="color:#f92672">|&gt;</span> put_view(<span style="color:#a6e22e">AppWeb.AuthView</span>)
        <span style="color:#f92672">|&gt;</span> render(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">token.json</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">token</span>: token)

      {<span style="color:#e6db74">:error</span>, message} <span style="color:#f92672">-&gt;</span>
        conn
        <span style="color:#f92672">|&gt;</span> put_status(<span style="color:#e6db74">:unauthorized</span>)
        <span style="color:#f92672">|&gt;</span> put_view(<span style="color:#a6e22e">AppWeb.AuthView</span>)
        <span style="color:#f92672">|&gt;</span> render(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">error.json</span><span style="color:#e6db74">&#34;</span>, %{<span style="color:#e6db74">message</span>: to_string(message)})
    end
  end
end
</code></pre></div><p><code>SessionController.create/2</code> fonksiyonu parametre olarka gelen email ve password ile <code>Auth.authenticate_user/2</code> fonksiyonunu çalıştırıp başarılı ve ya hatalı durumlara göre malum cevapları verecektir. Şimdi <code>Auth</code> modülünde <code>authenticate_user/2</code> fonksiyonumuzu yazmamız gerekiyor.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ex" data-lang="ex"><span style="color:#75715e"># lib/app/auth.ex</span>
defmodule <span style="color:#a6e22e">App.Auth</span> do
  <span style="color:#75715e"># ...</span>

  def authenticate_user(email, password) do
    case <span style="color:#a6e22e">Repo</span><span style="color:#f92672">.</span>one(from(u in <span style="color:#a6e22e">User</span>, <span style="color:#e6db74">where</span>: u<span style="color:#f92672">.</span>email <span style="color:#f92672">==</span> <span style="color:#f92672">^</span>email)) do
      nil <span style="color:#f92672">-&gt;</span>
        {<span style="color:#e6db74">:error</span>, <span style="color:#e6db74">:invalid_credentials</span>}
      user <span style="color:#f92672">-&gt;</span>
        if <span style="color:#a6e22e">Bcrypt</span><span style="color:#f92672">.</span>verify_pass(password, user<span style="color:#f92672">.</span>password_digest) do
          <span style="color:#a6e22e">App.Auth.Guardian</span><span style="color:#f92672">.</span>encode_and_sign(user)
        else
          {<span style="color:#e6db74">:error</span>, <span style="color:#e6db74">:invalid_credentials</span>}
        end
    end
  end
end
</code></pre></div><p>Bu fonksiyon ise verilen email ile veritabanında kullanıcımızı arar, bulursa ve <code>Bcrypt.verify_pass/2</code> fonksiyonu ile verilen password ile veritabanındaki hashlenmiş passwordü test eder, verilen bilgiler doğru ise <code>Guardian.encode_and_sign</code> fonksiyonu ile bir <code>JWT</code> token ile birlikte claims oluşturup döndürür, bulamazsa ve ya password yanlış ise <code>{:error, :invalid_credentials}</code> şeklinde bir tuple döndürür.</p>
<p><code>SessionController</code>'a dönersek response için <code>AuthView</code> kullanmıştık. <code>AuthView</code> modülümüzü de aşağıdaki gibi oluşturalım.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ex" data-lang="ex"><span style="color:#75715e"># lib/app_web/views/auth_view.ex</span>

defmodule <span style="color:#a6e22e">AppWeb.AuthView</span> do
  use <span style="color:#a6e22e">AppWeb</span>, <span style="color:#e6db74">:view</span>

  def render(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">token.json</span><span style="color:#e6db74">&#34;</span>, %{<span style="color:#e6db74">token</span>: token} <span style="color:#f92672">=</span> _) do
    %{<span style="color:#e6db74">token</span>: token}
  end

  def render(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">error.json</span><span style="color:#e6db74">&#34;</span>, %{<span style="color:#e6db74">message</span>: message}) do
    %{<span style="color:#e6db74">error</span>: message}
  end
end
</code></pre></div><p><strong>Sonuçlar</strong></p>
<p>Şimdi <a href="http://localhost:4000/api/v1/users"><code>localhost:4000/api/v1/users</code></a> adresine get requesti attığımızda aşağıdaki gibi bir cevap almamız gerekiyor.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">http :4000/api/v1/users | jq
HTTP/1.1 <span style="color:#ae81ff">401</span> Unauthorized
cache-control: max-age<span style="color:#f92672">=</span>0, private, must-revalidate
content-length: <span style="color:#ae81ff">37</span>
content-type: application/json; charset<span style="color:#f92672">=</span>utf-8
date: Sun, <span style="color:#ae81ff">14</span> Apr <span style="color:#ae81ff">2019</span> 19:03:02 GMT
server: Cowboy
x-request-id: FZVsiSTULGUhyEwAAA3E

<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;meta&#34;</span>: <span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;status&#34;</span>: <span style="color:#e6db74">&#34;Unauthenticated&#34;</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Gördüğünüz gibi <code>:ensure_auth</code> pipeline'ı yetkisiz erişimi engelledi. Önce gidip bir access token almamız gerekiyor. Bunu da aşağıdaki gibi deneyelim.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">http --form POST :4000/api/auth/sign_in <span style="color:#e6db74">&#39;user[email]=muratbsts@gmail.com&#39;</span> <span style="color:#e6db74">&#39;user[password]=password&#39;</span>
HTTP/1.1 <span style="color:#ae81ff">200</span> OK
cache-control: max-age<span style="color:#f92672">=</span>0, private, must-revalidate
content-length: <span style="color:#ae81ff">467</span>
content-type: application/json; charset<span style="color:#f92672">=</span>utf-8
date: Sun, <span style="color:#ae81ff">14</span> Apr <span style="color:#ae81ff">2019</span> 19:13:31 GMT
server: Cowboy
x-request-id: FZVtG8GKfJ2sj3oAABIh

<span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;token&#34;</span>: <span style="color:#e6db74">&#34;eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.....JWRohW7yVxs978V4SV87g2BUFBT1BlpYNtsSfiOxPvss1hOiuUyZ1ZqIYOwyJ0-DYSPs63oEPGdA...&#34;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Ve bu token ile users endpointimize request yaparsak aşağıdaki gibi bir başarılı bir sonuç alacağız.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">http :4000/api/v1/users <span style="color:#e6db74">&#39;Authorization:Bearer eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.....JWRohW7yVxs978V4SV87g2BUFBT1BlpYNtsSfiOxPvss1hOiuUyZ1ZqIYOwyJ0-DYSPs63oEPGdA...&#39;</span>
HTTP/1.1 <span style="color:#ae81ff">200</span> OK
cache-control: max-age<span style="color:#f92672">=</span>0, private, must-revalidate
content-length: <span style="color:#ae81ff">1536</span>
content-type: application/json; charset<span style="color:#f92672">=</span>utf-8
date: Sun, <span style="color:#ae81ff">14</span> Apr <span style="color:#ae81ff">2019</span> 19:15:32 GMT
server: Cowboy
x-request-id: FZVtN9wwpCWV8KcAABJh

<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;data&#34;</span>: <span style="color:#f92672">[</span>
    <span style="color:#f92672">{</span>
      <span style="color:#e6db74">&#34;email&#34;</span>: <span style="color:#e6db74">&#34;muratbsts@gmail.com&#34;</span>,
      <span style="color:#e6db74">&#34;id&#34;</span>: 1,
      <span style="color:#e6db74">&#34;inserted_at&#34;</span>: <span style="color:#e6db74">&#34;2019-04-03T21:16:09&#34;</span>,
      <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;murat&#34;</span>,
      <span style="color:#e6db74">&#34;updated_at&#34;</span>: <span style="color:#e6db74">&#34;2019-04-03T21:16:09&#34;</span>
    <span style="color:#f92672">}</span>,
    ....
  <span style="color:#f92672">}</span>
<span style="color:#f92672">]</span>
</code></pre></div><p>Ve böylece ikinci bölümün de sonuna geldik. Bir sonraki bölümde kaydolan kullanıcılara email göndererek doğrulama yapacağız&hellip;</p>
<p>Şimdi <a href="/2019/05/12/phoenix-api-uygulamas%C4%B1-part-3/">şuradan devam</a> edebilirsiniz&hellip;</p>

  </article>

  





    
    
    
        
    




<section id="articleNext" class="section nartrow">
    <h3 class="footer-next-heading">More articles from muratbastas</h3>
    <div class="footer-spacer"></div>
    <div class="next-articles-grid" numberOfArticles={numberOfArticles}>
        <div class="post-row">
            
                <a href="/2019/04/13/phoenix-api-uygulamas%C4%B1-part-1/" class="article-link"
                 id="article-link-bigger">
                    <div>
                        
                        <div>
                            <h2 class="article-title">
                                Phoenix API uygulaması (part 1)
                            </h2>
                            <p class="article-excerpt">
                                
                            </p>
                            <div class="article-metadata">
                                April 4, 2019
                            </div>
                        </div>
                    </div>
                </a>
            
                <a href="/2019/04/13/hepsine-h%C3%BCkmedecek-tek-versiyon-y%C3%B6neticisi-asdf/" class="article-link"
                >
                    <div>
                        
                        <div>
                            <h2 class="article-title">
                                Hepsine hükmedecek tek versiyon yöneticisi &#39;ASDF&#39;
                            </h2>
                            <p class="article-excerpt">
                                
                            </p>
                            <div class="article-metadata">
                                April 4, 2019
                            </div>
                        </div>
                    </div>
                </a>
            
        </div>
    </div>
</section>

</section>


<script src="/js/progressBar.js"></script>

        
        <div class="footer-gradient"></div>
    <div class="section narrow">
      <div class="footer-hr"></div>
      <div class="footer-container">
        <div class="footer-text">
          © 2020 muratbastas
        </div>
        <div class="social-icon-outer">
    <div class="social-icon-container">
        
        
        
        <a href="https://github.com/murat" target="_blank"><svg
class="social-icon-image"
width="14"
height="14"
viewBox="0 0 14 14"
fill="none"
xmlns="http://www.w3.org/2000/svg"
>
<path
  fillRule="evenodd"
  clipRule="evenodd"
  d="M7 0C3.1325 0 0 3.21173 0 7.17706C0 10.3529 2.00375 13.0353 4.78625 13.9863C5.13625 14.0491 5.2675 13.8338 5.2675 13.6454C5.2675 13.4749 5.25875 12.9097 5.25875 12.3087C3.5 12.6406 3.045 11.8691 2.905 11.4653C2.82625 11.259 2.485 10.622 2.1875 10.4516C1.9425 10.317 1.5925 9.98508 2.17875 9.97611C2.73 9.96714 3.12375 10.4964 3.255 10.7118C3.885 11.7973 4.89125 11.4923 5.29375 11.3039C5.355 10.8374 5.53875 10.5234 5.74 10.3439C4.1825 10.1645 2.555 9.54549 2.555 6.80026C2.555 6.01976 2.82625 5.37382 3.2725 4.87143C3.2025 4.692 2.9575 3.95635 3.3425 2.96951C3.3425 2.96951 3.92875 2.78111 5.2675 3.70516C5.8275 3.54367 6.4225 3.46293 7.0175 3.46293C7.6125 3.46293 8.2075 3.54367 8.7675 3.70516C10.1063 2.77214 10.6925 2.96951 10.6925 2.96951C11.0775 3.95635 10.8325 4.692 10.7625 4.87143C11.2087 5.37382 11.48 6.01079 11.48 6.80026C11.48 9.55446 9.84375 10.1645 8.28625 10.3439C8.54 10.5682 8.75875 10.9988 8.75875 11.6717C8.75875 12.6316 8.75 13.4032 8.75 13.6454C8.75 13.8338 8.88125 14.0581 9.23125 13.9863C11.9963 13.0353 14 10.3439 14 7.17706C14 3.21173 10.8675 0 7 0Z"
  fill="#73737D"
/>
</svg></a>
        <span class="hidden">https://github.com/murat</span>
        
        
        
        
        <a href="https://www.linkedin.com/in/muratbastas/" target="_blank"><svg
class="social-icon-image"
width="14"
height="14"
viewBox="0 0 14 14"
fill="none"
xmlns="http://www.w3.org/2000/svg"
{...props}
>
<path
  fillRule="evenodd"
  clipRule="evenodd"
  d="M3.59615 13.125H0.871552V4.36523H3.59615V13.125ZM2.24847 3.16406C1.81878 3.16406 1.44769 3.00781 1.13519 2.69531C0.822692 2.38281 0.666443 2.01171 0.666443 1.58203C0.666443 1.15234 0.822692 0.781248 1.13519 0.468749C1.44769 0.156249 1.81878 0 2.24847 0C2.67816 0 3.04925 0.156249 3.36175 0.468749C3.67425 0.781248 3.8305 1.15234 3.8305 1.58203C3.8305 2.01171 3.67425 2.38281 3.36175 2.69531C3.04925 3.00781 2.67816 3.16406 2.24847 3.16406ZM13.7915 13.125H11.0669V8.84765C11.0669 8.14452 11.0083 7.63671 10.8911 7.32421C10.6763 6.79687 10.2563 6.5332 9.63134 6.5332C9.00634 6.5332 8.56689 6.76757 8.31298 7.23632C8.11767 7.58788 8.02001 8.10546 8.02001 8.78905V13.125H5.32471V4.36523H7.93212V5.5664H7.96142C8.15673 5.17578 8.46923 4.85351 8.89892 4.59961C9.36767 4.28711 9.91454 4.13086 10.5395 4.13086C11.8091 4.13086 12.6977 4.53125 13.2055 5.33203C13.5962 5.97656 13.7915 6.97265 13.7915 8.3203V13.125Z"
  fill="#73737D"
/>
</svg></a>
        <span class="hidden">https://www.linkedin.com/in/muratbastas/</span>
        
        
        
        
        <a href="https://medium.com/@muratbastas" target="_blank"><svg
class="social-icon-image"
width="13"
height="11"
viewBox="0 0 13 11"
fill="none"
xmlns="http://www.w3.org/2000/svg"
>
<path
  fillRule="evenodd"
  clipRule="evenodd"
  d="M1.51041 2.69775C1.51041 2.5415 1.44965 2.40261 1.32812 2.28108L0.15625 0.874837V0.666504H3.82812L6.64061 6.86441L9.11456 0.666504H12.6041V0.874837L11.5885 1.83838C11.5017 1.90782 11.467 2.00331 11.4843 2.12483V9.20815C11.467 9.32968 11.5017 9.42516 11.5885 9.49461L12.5781 10.4581V10.6665H7.63019V10.4581L8.64581 9.46857C8.6979 9.41648 8.72828 9.37742 8.73696 9.35138C8.74564 9.32534 8.74998 9.26891 8.74998 9.18211V3.45296L5.93749 10.6404H5.54686L2.23958 3.45296V8.27065C2.22222 8.47898 2.28298 8.66128 2.42187 8.81753L3.74999 10.4321V10.6404H0V10.4321L1.32812 8.81753C1.48437 8.66128 1.54514 8.47898 1.51041 8.27065V2.69775Z"
  fill="#73737D"
/>
</svg></a>
        <span class="hidden">https://medium.com/@muratbastas</span>
        
        
        
        
        <a href="https://twitter.com/muratbastas" target="_blank"><svg
class="social-icon-image"
width="16"
height="13"
viewBox="0 0 16 13"
fill="none"
xmlns="http://www.w3.org/2000/svg"
{...props}
>
<path
  fillRule="evenodd"
  clipRule="evenodd"
  d="M14.0658 2.34438C14.7013 1.96349 15.1892 1.3604 15.419 0.641811C14.8244 0.994439 14.1658 1.25056 13.4648 1.3886C12.9034 0.7905 12.1036 0.416748 11.2185 0.416748C9.51888 0.416748 8.14096 1.79461 8.14096 3.49411C8.14096 3.7353 8.16822 3.97019 8.22068 4.19542C5.66301 4.06708 3.39543 2.84191 1.8776 0.980064C1.6127 1.43458 1.46094 1.96322 1.46094 2.52719C1.46094 3.59485 2.00428 4.5368 2.83003 5.08865C2.32553 5.07268 1.85104 4.93425 1.43608 4.70376C1.43586 4.71659 1.43586 4.72949 1.43586 4.74244C1.43586 6.23349 2.49666 7.47732 3.90448 7.75999C3.64622 7.83033 3.37436 7.86792 3.09366 7.86792C2.89537 7.86792 2.70257 7.84866 2.51471 7.81272C2.90629 9.03537 4.0428 9.92509 5.38945 9.94994C4.33623 10.7753 3.00928 11.2673 1.56749 11.2673C1.31911 11.2673 1.07413 11.2528 0.833374 11.2243C2.19527 12.0975 3.81291 12.6069 5.55081 12.6069C11.2113 12.6069 14.3067 7.91763 14.3067 3.85096C14.3067 3.71753 14.3037 3.5848 14.2978 3.45285C14.899 3.01896 15.4208 2.47694 15.8334 1.8598C15.2815 2.10456 14.6884 2.26998 14.0658 2.34438Z"
  fill="#73737D"
/>
</svg></a>
        <span class="hidden">https://twitter.com/muratbastas</span>
        
        
    </div>
</div>

    </div>
</div>

    </div>

    
    <script src="/js/prism.js"></script>
</body>

</html>